# üöÄ Quick Deployment Reference

## Port Binding - CRITICAL FIX ‚úÖ

### Problem
Render service keeps restarting because Gunicorn binds to hardcoded port 8000 instead of dynamic `$PORT`.

### Solution (FIXED)
All deployment files now use `$PORT` correctly:

```bash
# ‚úÖ render.yaml
gunicorn url_monitor.wsgi:application --bind 0.0.0.0:$PORT

# ‚úÖ Procfile
web: gunicorn url_monitor.wsgi:application --bind 0.0.0.0:$PORT

# ‚úÖ Dockerfile
CMD gunicorn --bind 0.0.0.0:${PORT:-8000} url_monitor.wsgi:application
```

---

## Deployment Options

### Option 1: Render Blueprint (Recommended) ‚ö°
**One-click deployment with auto-provisioning**

1. Push code to GitHub:
   ```bash
   git add .
   git commit -m "v2.0.1: Fixed port binding for Render"
   git push origin main
   ```

2. Connect to Render:
   - Go to https://render.com/
   - Click "New" ‚Üí "Blueprint"
   - Connect GitHub repository
   - Select `render.yaml`
   - Click "Apply"

3. Render auto-creates:
   - ‚úÖ PostgreSQL database
   - ‚úÖ Redis instance
   - ‚úÖ Web service (Gunicorn)
   - ‚úÖ Celery worker
   - ‚úÖ Celery beat

4. Set environment variable:
   - `ALLOWED_HOSTS=your-app.onrender.com`

**Status:** Should show "Live" in 5-10 minutes

---

### Option 2: Docker Deployment üê≥

```bash
# Build image
docker build -t url-monitor .

# Run locally (test)
docker run -p 8000:8000 -e PORT=8000 url-monitor

# Deploy to Docker Hub
docker tag url-monitor your-username/url-monitor:latest
docker push your-username/url-monitor:latest
```

---

### Option 3: Heroku üéØ

```bash
# Login
heroku login

# Create app
heroku create url-monitor

# Add PostgreSQL
heroku addons:create heroku-postgresql:mini

# Add Redis
heroku addons:create heroku-redis:mini

# Set environment variables
heroku config:set SECRET_KEY=$(python -c "import secrets; print(secrets.token_urlsafe(50))")
heroku config:set DEBUG=False
heroku config:set ALLOWED_HOSTS=url-monitor.herokuapp.com

# Deploy
git push heroku main

# Run migrations
heroku run python manage.py migrate

# Create superuser
heroku run python manage.py createsuperuser

# Scale workers
heroku ps:scale web=1 worker=1 beat=1
```

---

## Required Environment Variables

### Essential (Production)
```bash
SECRET_KEY=your-secret-key-here          # Auto-generated by Render
DEBUG=False                              # Always False in production
ALLOWED_HOSTS=your-app.onrender.com      # YOUR DOMAIN HERE
DATABASE_URL=postgresql://...            # Auto-linked by Render
REDIS_URL=redis://...                    # Auto-linked by Render
CELERY_BROKER_URL=redis://...            # Same as REDIS_URL
CELERY_RESULT_BACKEND=redis://...        # Same as REDIS_URL
```

### Optional (Notifications)
```bash
# Email alerts
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# Telegram alerts
TELEGRAM_BOT_TOKEN=your-bot-token

# Slack alerts
SLACK_WEBHOOK_URL=your-webhook-url
```

---

## Post-Deployment Checklist

### 1. Verify Service Status
- [ ] Web service shows "Live" (green dot)
- [ ] Worker service running
- [ ] Beat service running
- [ ] No restart loops in logs

### 2. Check Logs
```bash
# Should see:
‚úÖ Listening at: http://0.0.0.0:XXXXX  (dynamic port, NOT 8000)
‚úÖ Booting worker with pid: XXXX
‚úÖ [INFO/MainProcess] Connected to redis://...
```

### 3. Test Endpoints
```bash
# Health check
curl https://your-app.onrender.com/

# Admin panel
https://your-app.onrender.com/admin/

# Tracking script (replace {url_id} with actual ID)
curl https://your-app.onrender.com/tracking/1/script.js

# API endpoint
curl -X POST https://your-app.onrender.com/api/track/1/ \
  -H "Content-Type: application/json" \
  -d '{"event_type":"pageview","url":"https://example.com"}'
```

### 4. Create Superuser
```bash
# In Render Shell
python manage.py createsuperuser
```

### 5. Test URL Monitoring
1. Log in to admin: `https://your-app.onrender.com/admin`
2. Add a URL to monitor
3. Check Celery worker logs for check execution

### 6. Test External Tracking
1. Get tracking script from URL detail page
2. Embed in external website:
   ```html
   <script src="https://your-app.onrender.com/tracking/1/script.js"></script>
   ```
3. Visit external site
4. Check Traffic Dashboard for analytics data

---

## Troubleshooting Quick Fixes

### Service Keeps Restarting
**Cause:** Port binding issue  
**Fix:** Already fixed in v2.0.1 - Dockerfile uses `${PORT:-8000}`

### Static Files Not Loading
```bash
# In Render Shell
python manage.py collectstatic --noinput
```

### Database Connection Failed
- Check `DATABASE_URL` is set
- Verify PostgreSQL service is running
- Run migrations: `python manage.py migrate`

### Celery Worker Not Running
- Check `CELERY_BROKER_URL` points to Redis
- Verify Redis service is running
- Check worker logs for errors

### CORS Errors
- Add your domain to `ALLOWED_HOSTS`
- Verify `external_tracking.py` has CORS headers
- Check browser console for specific errors

---

## Performance Tips (Free Tier)

### Reduce Memory Usage
```bash
# Use fewer workers
gunicorn --workers 2 --threads 2 url_monitor.wsgi:application
```

### Prevent Spin-Down
Use UptimeRobot to ping every 5 minutes:
```
https://your-app.onrender.com/
```

### Optimize Database
```python
# Enable connection pooling in settings.py
DATABASES = {
    'default': dj_database_url.config(
        conn_max_age=600,
        conn_health_checks=True,
    )
}
```

---

## Success Indicators

‚úÖ **Deployment Successful When:**
- Service status: "Live" (green)
- Logs show dynamic port: `Listening at: http://0.0.0.0:XXXXX`
- No repeated restarts
- Static files load: `https://your-app.onrender.com/static/css/styles.css`
- Admin panel accessible: `https://your-app.onrender.com/admin/`
- Tracking script loads: `https://your-app.onrender.com/tracking/1/script.js`
- Celery worker logs show task execution
- URLs are being monitored automatically
- Analytics data appears in dashboard

---

## Getting Help

### Documentation
- üìö Full Guide: `docs/RENDER_DEPLOYMENT.md`
- üêõ Troubleshooting: `docs/RENDER_TROUBLESHOOTING.md`
- üìä Analytics Setup: `docs/EXTERNAL_TRACKING_GUIDE.md`
- üß™ Testing: `docs/TESTING_WITH_DEPLOYED_SITES.md`

### Support
- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/5.2/howto/deployment/
- GitHub Issues: https://github.com/MDhruv03/URL-Monitor/issues

---

**Version:** 2.0.1  
**Last Updated:** October 25, 2025  
**Status:** ‚úÖ Production Ready
