{% extends 'base.html' %}
<div class="card bg-black border-secondary">
    <div class="card-header">
        <h5>Traffic Last 24 Hours</h5>
    </div>
    <div class="card-body">
        <canvas id="trafficChart" height="150"></canvas>
        <div class="row mt-3">
            <div class="col-md-6">
                <canvas id="statusChart" height="200"></canvas>
            </div>
            <div class="col-md-6">
                <div class="card bg-dark">
                    <div class="card-body">
                        <h6>Peak Traffic</h6>
                        <p>{{ peak_time }} with {{ peak_requests }} requests</p>
                        <h6 class="mt-3">Bandwidth</h6>
                        <p>{{ total_bandwidth|floatformat:2 }} MB used</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
new Chart(document.getElementById('trafficChart'), {
    type: 'line',
    data: {
        labels: JSON.parse('{{ time_labels|escapejs }}'),
        datasets: [
            {
                label: 'Requests',
                data: JSON.parse('{{ request_data|escapejs }}'),
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)'
            },
            {
                label: 'Bandwidth (MB)',
                data: JSON.parse('{{ bandwidth_data|escapejs }}'),
                borderColor: 'rgba(153, 102, 255, 1)',
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                yAxisID: 'y1'
            }
        ]
    },
    options: {
        scales: {
            y: { title: { display: true, text: 'Requests' }},
            y1: { 
                position: 'right',
                title: { display: true, text: 'MB' }
            }
        }
    }
});
</script>